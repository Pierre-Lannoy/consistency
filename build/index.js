(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var s in n)e.o(n,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:n[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.plugins,n=window.wp.data,s=window.wp.coreData,o=window.wp.domReady;var c=e.n(o);const i=[{name:"quote",mask:/\'/g,replace:"’",nbMoved:0},{name:"ellipsis",mask:/\.{3}/g,replace:"…",nbMoved:-2},{name:"breakingSpace",mask:/ (?=[\?|\!|\:|\;|\»|\€|\$|\£|\¥|\₽|\元|\%])/g,replace:" ",nbMoved:0}],r=window.wp.element,l=window.wp.i18n,a=window.wp.editPost,u=window.wp.components,d=window.wp.notices,p=()=>{const{currentUser:e}=(0,n.useSelect)((e=>({currentUser:e(s.store).getCurrentUser()})),[]),t=e&&e.id,[o,c]=(0,s.useEntityProp)("root","user","meta",t),{saveEditedEntityRecord:i}=(0,n.useDispatch)(s.store),{createNotice:a}=(0,n.useDispatch)(d.store);return(0,r.createElement)(u.ToggleControl,{label:(0,l.__)("Consistency correction","consistency"),help:(0,l.__)("Turn on/off autocorrect for my account","consistency"),checked:o?.consistency_plugin_setting_state[0]||!1,onChange:e=>{c({consistency_plugin_setting_state:[e]}),i("root","user",t,{consistency_plugin_setting_state:[e]}),a((0,l.__)("info","consistency"),e?(0,l.__)("Consistency correction is enabled","consistency"):(0,l.__)("Consistency correction is disabled","consistency"),{isDismissible:!0})}})},g=()=>{const[e,t]=(0,s.useEntityProp)("root","site","consistency_plugin_settings",void 0),{saveEditedEntityRecord:o}=(0,n.useDispatch)(s.store),{createNotice:c}=(0,n.useDispatch)(d.store);return(0,r.createElement)(u.ToggleControl,{label:(0,l.__)("Quote correction","consistency"),help:(0,r.createElement)(r.Fragment,null,(0,l.__)("Replaces straight quotes ","consistency"),(0,r.createElement)("code",null,"'"),(0,l.__)(" with curved quotes ","consistency"),(0,r.createElement)("code",null,"’")),checked:e?.find((e=>"quote"===e.slug))?.value||!1,onChange:n=>{let s=e.map((e=>"quote"===e.slug?{...e,value:n}:e));s?.find((e=>"quote"===e.slug))||s.push({slug:"quote",value:n}),t(s),o("root","site",void 0,s),c((0,l.__)("info","consistency"),n?(0,l.__)("Quote correction is enabled","consistency"):(0,l.__)("Quote correction is disabled","consistency"),{isDismissible:!0})}})},_=()=>{const[e,t]=(0,s.useEntityProp)("root","site","consistency_plugin_settings",void 0),{saveEditedEntityRecord:o}=(0,n.useDispatch)(s.store),{createNotice:c}=(0,n.useDispatch)(d.store);return(0,r.createElement)(u.ToggleControl,{label:(0,l.__)("Ellipsis correction","consistency"),help:(0,r.createElement)(r.Fragment,null,(0,l.__)("Replaces 3 dots ","consistency"),(0,r.createElement)("code",null,"..."),(0,l.__)(" with ellipsis ","consistency"),(0,r.createElement)("code",null,"…")),checked:e?.find((e=>"ellipsis"===e.slug))?.value||!1,onChange:n=>{let s=e.map((e=>"ellipsis"===e.slug?{...e,value:n}:e));s?.find((e=>"ellipsis"===e.slug))||s.push({slug:"ellipsis",value:n}),t(s),o("root","site",void 0,s),c((0,l.__)("info","consistency"),n?(0,l.__)("Ellipsis correction is enabled","consistency"):(0,l.__)("Ellipsis correction is disabled","consistency"),{isDismissible:!0})}})},y=()=>{const[e,t]=(0,s.useEntityProp)("root","site","consistency_plugin_settings",void 0),{saveEditedEntityRecord:o}=(0,n.useDispatch)(s.store),{createNotice:c}=(0,n.useDispatch)(d.store);return(0,r.createElement)(u.ToggleControl,{label:(0,l.__)("Breaking space correction","consistency"),help:(0,r.createElement)(r.Fragment,null,(0,l.__)("Replaces a breaking space followed by a character from this list:","consistency"),(0,r.createElement)("br",null),(0,r.createElement)("code",null,"? ! : ; » € $ £ ¥ ₽ 元 %"),(0,l.__)(" with a non-breaking space","consistency")),checked:e?.find((e=>"breakingSpace"===e.slug))?.value||!1,onChange:n=>{let s=e.map((e=>"breakingSpace"===e.slug?{...e,value:n}:e));s?.find((e=>"breakingSpace"===e.slug))||s.push({slug:"breakingSpace",value:n}),t(s),o("root","site",void 0,s),c((0,l.__)("info","consistency"),n?(0,l.__)("Breaking space correction is enabled","consistency"):(0,l.__)("Breaking space correction is disabled","consistency"),{isDismissible:!0})}})},{canUser:m}=(0,n.select)("core"),{getBlockName:k,getBlockAttributes:b,getSelectionStart:E}=(0,n.select)("core/block-editor"),{updateBlock:h,selectionChange:w}=(0,n.dispatch)("core/block-editor"),v=["core/paragraph","core/heading","core/post-title"],f=["core/paragraph","core/heading","core/post-title"];let C=!1,P=[];const{getBlocks:S,getSelectedBlockClientId:B}=(0,n.select)("core/block-editor"),{getEntityRecord:R}=(0,n.select)("core"),{updateBlockAttributes:x}=(0,n.dispatch)("core/block-editor");(0,t.registerPlugin)("consistency-custom-sidebar",{icon:()=>(0,r.createElement)(u.Icon,{icon:(0,r.createElement)("svg",{version:"1.1",id:"consistency-plugin",x:"0px",y:"0px",width:"24px",height:"24px",viewBox:"0 0 24 24",enableBackground:"new 0 0 24 24"},(0,r.createElement)("line",{fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",x1:"4",y1:"20",x2:"7",y2:"20"}),(0,r.createElement)("line",{fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",x1:"14",y1:"20",x2:"21",y2:"20"}),(0,r.createElement)("line",{fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",x1:"6.9",y1:"15",x2:"13.8",y2:"15"}),(0,r.createElement)("line",{fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",x1:"10.2",y1:"6.3",x2:"16",y2:"20"}),(0,r.createElement)("polyline",{fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",points:"5,20 11,4 13,4 20,20 "}))}),render:()=>{const e=m("create","users");return(0,r.createElement)(r.Fragment,null,(0,r.createElement)(a.PluginSidebar,{name:"consistency-custom-sidebar",title:(0,l.__)("Consistency Settings","consistency")},(0,r.createElement)(u.PanelBody,{title:(0,l.__)("Status","consistency"),initialOpen:!0},(0,r.createElement)(u.PanelRow,null,(0,r.createElement)(p,null))),e&&(0,r.createElement)(u.PanelBody,{title:(0,l.__)("Global Settings","consistency"),initialOpen:!0},(0,r.createElement)(u.PanelRow,null,(0,r.createElement)(g,null)),(0,r.createElement)(u.PanelRow,null,(0,r.createElement)(_,null)),(0,r.createElement)(u.PanelRow,null,(0,r.createElement)(y,null)))),(0,r.createElement)(a.PluginSidebarMoreMenuItem,{target:"consistency-custom-sidebar"},(0,l.__)("Consistency Settings","consistency")))}}),c()((()=>{document.querySelector(" #editor ")?.addEventListener("paste",(e=>{C=!0,e.preventDefault()})),(0,n.subscribe)((()=>{const e=(0,n.select)(s.store).getCurrentUser();if(!R("root","user",e?.id||0,"consistency_plugin_setting_state")?.meta?.consistency_plugin_setting_state[0])return;const t=R("root","site")?.consistency_plugin_settings;if(void 0===t)return;if(P=i.filter((e=>!0===t?.find((t=>t.slug===e.name))?.value)),C)return void(()=>{const e=S().reduce(((e,t)=>{let n=t.attributes?.content;return Object.entries(P).forEach((e=>{let[s,o]=e;f.includes(t.name)&&void 0!==n&&(n=n.replaceAll(o.mask,o.replace))})),e[t.clientId]={content:n},e}),{});Object.keys(e).length&&C&&(C=!1,x(Object.keys(e),e,!0))})();const o=B();null!==o&&(e=>{const{currentBlockId:t,theRegs:n}=e,s=k(t);if(!v.includes(s))return;let o=b(t);o&&o.hasOwnProperty("content")&&""!==o.content&&Object.entries(n).forEach((e=>{let[n,c]=e;if(!c.mask.test(o.content))return;const i=0!==c.nbMoved,r=E(s);o.content=o.content.replaceAll(c.mask,c.replace),h(t,o),i&&w(t,r.attributeKey,r.offset-1,r.offset+c.nbMoved)}))})({currentBlockId:o,theRegs:P})}))}))})();