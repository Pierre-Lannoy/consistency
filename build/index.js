(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var s in n)e.o(n,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:n[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.plugins,n=window.wp.data,s=window.wp.coreData,o=window.wp.domReady;var c=e.n(o);const r=["core/paragraph","core/heading","core/quote","core/list-item","core/freeform","core/read-more"],i=[{name:"quote",mask:/\'/g,replace:"’",nbMoved:0,locales:["fr_FR","fr_BE","en_US","en_AU","en_CA","en_NZ","en_ZA","en_GB"]},{name:"ellipsis",mask:/\.{3}/g,replace:"…",nbMoved:-2,locales:["fr_FR","fr_BE","en_US","en_AU","en_CA","en_NZ","en_ZA","en_GB"]},{name:"regularToCurlyQuotes",mask:/"([^"]*)"/g,replace:"“$1”",nbMoved:0,locales:["en_US","en_AU","en_CA","en_NZ","en_ZA","en_GB"]},{name:"regularToFrenchQuotes",mask:/"([^"]*)"/g,replace:"« $1 »",nbMoved:2,locales:["fr_FR","fr_BE"]},{name:"breakingSpace",mask:/ (?=[\?|\!|\:|\;|\»|\€|\$|\£|\¥|\₽|\元|\%])/g,replace:" ",nbMoved:0,locales:["fr_FR","fr_BE"]},{name:"noSpaceBefore",mask:/(?<! | )([\?|\!|\:|\;|\»|\€|\$|\£|\¥|\₽|\元|\%])/g,replace:" $1",nbMoved:1,locales:["fr_FR","fr_BE"]},{name:"spaceBefore",mask:/([ | ])(?=[\?|\!|\:|\;|\%])/g,replace:"",nbMoved:-1,locales:["en_US","en_AU","en_CA","en_NZ","en_ZA","en_GB"]}],l=window.wp.element,a=window.wp.i18n,u=window.wp.editPost,d=window.wp.components,p=()=>(0,l.createElement)(d.Icon,{icon:(0,l.createElement)("svg",{version:"1.1",id:"consistency-plugin",x:"0px",y:"0px",width:"24px",height:"24px",viewBox:"0 0 24 24",enableBackground:"new 0 0 24 24"},(0,l.createElement)("line",{fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",x1:"4",y1:"20",x2:"7",y2:"20"}),(0,l.createElement)("line",{fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",x1:"14",y1:"20",x2:"21",y2:"20"}),(0,l.createElement)("line",{fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",x1:"6.9",y1:"15",x2:"13.8",y2:"15"}),(0,l.createElement)("line",{fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",x1:"10.2",y1:"6.3",x2:"16",y2:"20"}),(0,l.createElement)("polyline",{fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",points:"5,20 11,4 13,4 20,20 "}))}),_=window.wp.notices,g=()=>{const{currentUser:e}=(0,n.useSelect)((e=>({currentUser:e(s.store).getCurrentUser()})),[]),t=e&&e.id,[o,c]=(0,s.useEntityProp)("root","user","meta",t),{saveEditedEntityRecord:r}=(0,n.useDispatch)(s.store),{createNotice:i}=(0,n.useDispatch)(_.store);return(0,l.createElement)(d.ToggleControl,{label:(0,a.__)("Consistency Correction","consistency"),help:(0,a.__)("Turn on/off autocorrect for my account","consistency"),checked:o?.consistency_plugin_setting_state[0]||!1,onChange:e=>{c({consistency_plugin_setting_state:[e]}),r("root","user",t,{consistency_plugin_setting_state:[e]}),i((0,a.__)("info","consistency"),e?(0,a.__)("Consistency Correction is enabled","consistency"):(0,a.__)("Consistency Correction is disabled","consistency"),{isDismissible:!0,type:"snackbar",speak:!0,explicitDismiss:!0})}})},y=e=>{const t=m(),n=i?.find((t=>t.name===e));return!(void 0===n||!n?.locales?.includes(t))},m=()=>{const{getEntityRecord:e}=(0,n.select)("core");return e("root","site")?.language||"en_US"},b=()=>{const e="quote";if(!y(e))return"";const[t,o]=(0,s.useEntityProp)("root","site","consistency_plugin_settings",void 0),{saveEditedEntityRecord:c}=(0,n.useDispatch)(s.store),{createNotice:r}=(0,n.useDispatch)(_.store);return(0,l.createElement)(d.PanelRow,null,(0,l.createElement)(d.ToggleControl,{label:(0,a.__)("Quote Correction","consistency"),help:(0,l.createElement)(l.Fragment,null,(0,a.__)("Replaces straight quotes with curved quotes:","consistency"),(0,l.createElement)("span",{"aria-hidden":"true",style:{display:"block"}},(0,l.createElement)("code",null,"'")," ",(0,l.createElement)("span",{style:{fontSize:"20px"}},"→")," ",(0,l.createElement)("code",null,"’"))),checked:t?.find((t=>t.slug===e))?.value||!1,onChange:n=>{let s=t.map((t=>e===t.slug?{...t,value:n}:t));s?.find((t=>t.slug===e))||s.push({slug:e,value:n}),o(s),c("root","site",void 0,s),r((0,a.__)("info","consistency"),n?(0,a.__)("Quote Correction is enabled","consistency"):(0,a.__)("Quote Correction is disabled","consistency"),{isDismissible:!0,type:"snackbar",speak:!0,explicitDismiss:!0})}}))},E=()=>{const e="ellipsis";if(!y(e))return"";const[t,o]=(0,s.useEntityProp)("root","site","consistency_plugin_settings",void 0),{saveEditedEntityRecord:c}=(0,n.useDispatch)(s.store),{createNotice:r}=(0,n.useDispatch)(_.store);return(0,l.createElement)(d.PanelRow,null,(0,l.createElement)(d.ToggleControl,{label:(0,a.__)("Ellipsis Correction","consistency"),help:(0,l.createElement)(l.Fragment,null,(0,a.__)("Replaces 3 dots with ellipsis:","consistency"),(0,l.createElement)("span",{"aria-hidden":"true",style:{display:"block"}},(0,l.createElement)("code",null,"...")," ",(0,l.createElement)("span",{style:{fontSize:"20px"}},"→")," ",(0,l.createElement)("code",null,"…"))),checked:t?.find((t=>t.slug===e))?.value||!1,onChange:n=>{let s=t.map((t=>e===t.slug?{...t,value:n}:t));s?.find((t=>t.slug===e))||s.push({slug:e,value:n}),o(s),c("root","site",void 0,s),r((0,a.__)("info","consistency"),n?(0,a.__)("Ellipsis Correction is enabled","consistency"):(0,a.__)("Ellipsis Correction is disabled","consistency"),{isDismissible:!0,type:"snackbar",speak:!0,explicitDismiss:!0})}}))},f=()=>{const e="breakingSpace";if(!y(e))return"";const[t,o]=(0,s.useEntityProp)("root","site","consistency_plugin_settings",void 0),{saveEditedEntityRecord:c}=(0,n.useDispatch)(s.store),{createNotice:r}=(0,n.useDispatch)(_.store);return(0,l.createElement)(d.PanelRow,null,(0,l.createElement)(d.ToggleControl,{label:(0,a.__)("Breaking space Correction","consistency"),help:(0,l.createElement)("span",{dangerouslySetInnerHTML:{__html:sprintf((0,a.__)("Replaces a breaking space followed by a character from this list:%1$s with a non-breaking space","consistency"),"<br /><code>? ! : ; » € $ £ ¥ ₽ 元 %</code><br />")}}),checked:t?.find((t=>t.slug===e))?.value||!1,onChange:n=>{let s=t.map((t=>e===t.slug?{...t,value:n}:t));s?.find((t=>t.slug===e))||s.push({slug:e,value:n}),o(s),c("root","site",void 0,s),r((0,a.__)("info","consistency"),n?(0,a.__)("Breaking space Correction is enabled","consistency"):(0,a.__)("Breaking space Correction is disabled","consistency"),{isDismissible:!0,type:"snackbar",speak:!0,explicitDismiss:!0})}}))},h=()=>{const e="regularToCurlyQuotes";if(!y(e))return"";const[t,o]=(0,s.useEntityProp)("root","site","consistency_plugin_settings",void 0),{saveEditedEntityRecord:c}=(0,n.useDispatch)(s.store),{createNotice:r}=(0,n.useDispatch)(_.store);return(0,l.createElement)(d.PanelRow,null,(0,l.createElement)(d.ToggleControl,{label:(0,a.__)("Regular quotes Correction","consistency"),help:(0,l.createElement)(l.Fragment,null,(0,a.__)("Replaces regular quotes with curly quotes:","consistency"),(0,l.createElement)("span",{"aria-hidden":"true",style:{display:"block"}},(0,l.createElement)("code",null,'" "')," ",(0,l.createElement)("span",{style:{fontSize:"20px"}},"→")," ",(0,l.createElement)("code",null,"“ ”"))),checked:t?.find((t=>t.slug===e))?.value||!1,onChange:n=>{let s=t.map((t=>e===t.slug?{...t,value:n}:t));s?.find((t=>t.slug===e))||s.push({slug:e,value:n}),o(s),c("root","site",void 0,s),r((0,a.__)("info","consistency"),n?(0,a.__)("Regular quotes to curly quotes Correction is enabled","consistency"):(0,a.__)("Regular quotes to curly quotes Correction is disabled","consistency"),{isDismissible:!0,type:"snackbar",speak:!0,explicitDismiss:!0})}}))},k=()=>{const e="regularToFrenchQuotes";if(!y(e))return"";const[t,o]=(0,s.useEntityProp)("root","site","consistency_plugin_settings",void 0),{saveEditedEntityRecord:c}=(0,n.useDispatch)(s.store),{createNotice:r}=(0,n.useDispatch)(_.store);return(0,l.createElement)(d.PanelRow,null,(0,l.createElement)(d.ToggleControl,{label:(0,a.__)("Regular quotes Correction","consistency"),help:(0,l.createElement)(l.Fragment,null,(0,a.__)("Replaces regular quotes with french quotes:","consistency"),(0,l.createElement)("span",{"aria-hidden":"true",style:{display:"block"}},(0,l.createElement)("code",null,'" "')," ",(0,l.createElement)("span",{style:{fontSize:"20px"}},"→")," ",(0,l.createElement)("code",null,"« »"))),checked:t?.find((t=>t.slug===e))?.value||!1,onChange:n=>{let s=t.map((t=>e===t.slug?{...t,value:n}:t));s?.find((t=>t.slug===e))||s.push({slug:e,value:n}),o(s),c("root","site",void 0,s),r((0,a.__)("info","consistency"),n?(0,a.__)("Regular quotes to french quotes Correction is enabled","consistency"):(0,a.__)("Regular quotes to french quotes Correction is disabled","consistency"),{isDismissible:!0,type:"snackbar",speak:!0,explicitDismiss:!0})}}))},v=()=>{const e="noSpaceBefore";if(!y(e))return"";const[t,o]=(0,s.useEntityProp)("root","site","consistency_plugin_settings",void 0),{saveEditedEntityRecord:c}=(0,n.useDispatch)(s.store),{createNotice:r}=(0,n.useDispatch)(_.store);return(0,l.createElement)(d.PanelRow,null,(0,l.createElement)(d.ToggleControl,{label:(0,a.__)("No space before Correction","consistency"),help:(0,l.createElement)("span",{dangerouslySetInnerHTML:{__html:sprintf((0,a.__)("Adds a non-breaking space before a character from this list:%1$s having no space before","consistency"),"<br /><code>? ! : ; » € $ £ ¥ ₽ 元 %</code><br />")}}),checked:t?.find((t=>t.slug===e))?.value||!1,onChange:n=>{let s=t.map((t=>e===t.slug?{...t,value:n}:t));s?.find((t=>t.slug===e))||s.push({slug:e,value:n}),o(s),c("root","site",void 0,s),r((0,a.__)("info","consistency"),n?(0,a.__)("No space before Correction is enabled","consistency"):(0,a.__)("No space before Correction is disabled","consistency"),{isDismissible:!0,type:"snackbar",speak:!0,explicitDismiss:!0})}}))},C=()=>{const e="spaceBefore";if(!y(e))return"";const[t,o]=(0,s.useEntityProp)("root","site","consistency_plugin_settings",void 0),{saveEditedEntityRecord:c}=(0,n.useDispatch)(s.store),{createNotice:r}=(0,n.useDispatch)(_.store);return(0,l.createElement)(d.PanelRow,null,(0,l.createElement)(d.ToggleControl,{label:(0,a.__)("Space before Correction","consistency"),help:(0,l.createElement)(l.Fragment,null,(0,a.__)("Remove any space preceding a character from this list:","consistency"),(0,l.createElement)("span",{style:{display:"block"}},(0,l.createElement)("code",null,"? ! : ; %"))),checked:t?.find((t=>t.slug===e))?.value||!1,onChange:n=>{let s=t.map((t=>e===t.slug?{...t,value:n}:t));s?.find((t=>t.slug===e))||s.push({slug:e,value:n}),o(s),c("root","site",void 0,s),r((0,a.__)("info","consistency"),n?(0,a.__)("Space before Correction is enabled","consistency"):(0,a.__)("Space before Correction is disabled","consistency"),{isDismissible:!0,type:"snackbar",speak:!0,explicitDismiss:!0})}}))},{canUser:w}=(0,n.select)("core"),{getBlockName:R,getBlockAttributes:D,getSelectionStart:S}=(0,n.select)("core/block-editor"),{updateBlock:B,selectionChange:x}=(0,n.dispatch)("core/block-editor");let P=!1,q=[];const{getBlocks:M,getSelectedBlockClientId:A}=(0,n.select)("core/block-editor"),{getEntityRecord:N}=(0,n.select)("core"),{updateBlockAttributes:T}=(0,n.dispatch)("core/block-editor");(0,t.registerPlugin)("consistency-custom-sidebar",{render:()=>{const e=w("create","users");return(0,l.createElement)(l.Fragment,null,(0,l.createElement)(u.PluginSidebar,{name:"consistency-custom-sidebar",title:(0,a.__)("Consistency Settings","consistency"),icon:p},(0,l.createElement)(d.PanelBody,{title:(0,a.__)("Status","consistency"),initialOpen:!0},(0,l.createElement)(d.PanelRow,null,(0,l.createElement)(g,null))),e&&(0,l.createElement)(d.PanelBody,{title:(0,a.__)("Global Settings","consistency"),initialOpen:!0},(0,l.createElement)(b,null),(0,l.createElement)(E,null),(0,l.createElement)(h,null),(0,l.createElement)(k,null),(0,l.createElement)(f,null),(0,l.createElement)(v,null),(0,l.createElement)(C,null))),(0,l.createElement)(u.PluginSidebarMoreMenuItem,{target:"consistency-custom-sidebar"},(0,a.__)("Consistency Settings","consistency")))}}),c()((()=>{document.querySelector(" #editor ")?.addEventListener("paste",(e=>{P=!0,e.preventDefault()})),(0,n.subscribe)((()=>{const e=(0,n.select)(s.store).getCurrentUser();if(!N("root","user",e?.id||0,"consistency_plugin_setting_state")?.meta?.consistency_plugin_setting_state[0])return;const t=N("root","site")?.consistency_plugin_settings;if(void 0===t)return;if(q=i.filter((e=>!0===t?.find((t=>t.slug===e.name))?.value)),P)return void(()=>{const e=M().reduce(((e,t)=>{let n=t.attributes?.content;return Object.entries(q).forEach((e=>{let[s,o]=e;r.includes(t.name)&&void 0!==n&&y(o.name)&&(n=n.replaceAll(o.mask,o.replace))})),e[t.clientId]={content:n},e}),{});Object.keys(e).length&&P&&(P=!1,T(Object.keys(e),e,!0))})();const o=A();null!==o&&q&&(e=>{const{currentBlockId:t,theRegs:n}=e,s=R(t);if(!r.includes(s))return;let o=D(t);o&&o.hasOwnProperty("content")&&""!==o.content&&Object.entries(n).forEach((e=>{let[n,c]=e;if(!c.mask.test(o.content)||!y(c.name))return;const r=0!==c.nbMoved,i=S(s);o.content=o.content.replaceAll(c.mask,c.replace),B(t,o),r&&c.nbMoved<0&&r&&x(t,i.attributeKey,i.offset-1,i.offset+c.nbMoved),r&&c.nbMoved>0&&r&&x(t,i.attributeKey,i.offset+1+c.nbMoved,i.offset+c.nbMoved)}))})({currentBlockId:o,theRegs:q})}))}))})();